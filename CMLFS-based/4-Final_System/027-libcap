# Final System: Libcap
# This section is done in Chroot environment

export PNAME="libcap"  &&
export   VER="2.6.8" &&
export  MJOB="-j2"   &&

# Apply patches from Chimera Linux:
patch -Np1 -i ../patches/libcap-chimera/no-bash.patch
patch -Np1 -i ../patches/libcap-chimera/remove-so-main.patch

# Prevent static libraries from being installed:
sed -i '/install -m.*STA/d' libcap/Makefile

# Compile with clang
make prefix=/usr lib=lib CC=clang $MJOB

# Install
make prefix=/usr \
     lib=lib \
     exec_prefix=/usr \
     RAISE_SETFCAP=no \
     PKGCONFIGDIR=/usr/lib/pkgconfig \
     SBINDIR=/usr/bin \
     LIBDIR=/usr/lib DESTDIR=$BUILD install

# Build package
cd ${BUILD} && mkdir -v ${BUILD}/install          &&
cp -v $DESCS/${PNAME} ${BUILD}/install/slack-desc &&
makepkg -l y -c n $PKGS/${PNAME}-${VER}-$PSUFFIX  &&

# Clean stage area
rm -rf ${BUILD}/* &&

# Install
spkg $PKGS/${PNAME}-${VER}-$PSUFFIX
