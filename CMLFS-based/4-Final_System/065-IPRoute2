# Final System: IProute2 
# This section is done in Chroot environment

export PNAME="iproute2"  &&
export   VER="6.6.0" &&
export  MJOB="-j2"   &&

# Per LFS, The arpd program included in this package will not be 
# built since it depends on Berkeley DB, which is not installed in 
# CMLFS. However, a directory and a man page for arpd will still 
# be installed. Prevent this by running the commands shown below. 
sed -i /ARPD/d Makefile
rm -fv man/man8/arpd.8

# Apply patches from Chimera Linux
patch -Np1 -i ../patches/iproute2-chimera/clang.patch
patch -Np1 -i ../patches/iproute2-chimera/min.patch

# Build. Requires bison
PATH=/opt/gnu/bin:$PATH \
make NETNS_RUN_DIR=/run/netns

# Install
make DOCDIR=/usr/share/doc/iproute2-6.6.0 \
     SBINDIR=/usr/sbin \
     DESTDIR=$BUILD install

# Build package
cd ${BUILD} && mkdir -v ${BUILD}/install          &&
cp -v $DESCS/${PNAME} ${BUILD}/install/slack-desc &&
makepkg -l y -c n $PKGS/${PNAME}-${VER}-$PSUFFIX  &&

# Clean stage area
rm -rf ${BUILD}/* &&

# Install
spkg $PKGS/${PNAME}-${VER}-$PSUFFIX
